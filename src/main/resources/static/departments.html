<!DOCTYPE html>
<html>
<head>
    <title>Departments</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>

        /* RESET */
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family:"Segoe UI",sans-serif;
        }


        /* HEADER FIXED */
        .header{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:60px;
            background:#e9e9ea;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:0 25px;
            z-index:1000;
        }

        .logo{
            display:flex;
            align-items:center;
            gap:12px;
            font-weight:600;
            font-size:22px;
            color:#1c2556;
        }

        .logo-circle{
            width:40px;
            height:40px;
            border:3px solid #1fa3a3;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            color:#1fa3a3;
            font-weight:bold;
        }

        .right-icons{
            display:flex;
            gap:22px;
            font-size:18px;
            color:#444;
        }


        /* SIDEBAR FIXED */
        .sidebar{
            position:fixed;
            top:60px;
            left:0;
            width:260px;
            height:calc(100vh - 60px);
            background:linear-gradient(#0b1437,#081028);
            padding:20px 15px;
            overflow-y:auto;
        }

        .menu{
            list-style:none;
        }

        .menu a{
            display:flex;
            align-items:center;
            gap:15px;
            padding:14px 18px;
            color:#cfd6ff;
            font-size:18px;
            text-decoration:none;
            border-radius:12px;
        }

        .menu a:hover{
            background:#111c44;
        }

        .menu a.active{
            background:linear-gradient(90deg,#5a4bff,#6f63ff);
            color:white;
        }


        /* CONTENT SCROLL */
        .content{
            margin-left:260px;
            margin-top:60px;
            height:calc(100vh - 60px);
            overflow-y:auto;
            padding:30px;
            background:#f5f7fb;
        }


        /* SEARCH */
        .search-box{
            margin:20px 0;
            display:flex;
            gap:10px;
        }

        .search-box input{
            flex:1;
            padding:12px;
            border-radius:8px;
            border:1px solid #ccc;
        }

        .search-box button{
            padding:12px 20px;
            border:none;
            background:#4f46e5;
            color:white;
            border-radius:8px;
            cursor:pointer;
        }


        /* FORM */
        .form-section{
            background:white;
            padding:25px;
            border-radius:14px;
            margin-top:25px;
            box-shadow:0 4px 12px rgba(0,0,0,0.08);
        }

        .form-section h3{
            margin-bottom:18px;
        }

        .form-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
            gap:18px;
        }

        .form-grid input{
            padding:12px;
            border-radius:8px;
            border:1px solid #ccc;
        }


        /* BUTTON */
        .add-btn{
            margin-top:20px;
            padding:12px 25px;
            background:#059669;
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
        }


        /* TABLE */
        .table{
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
        }

        .table th{
            background:#eef2ff;
            padding:12px;
            text-align:left;
        }

        .table td{
            padding:12px;
            border-bottom:1px solid #eee;
        }


        /* ACTION BUTTONS */
        .edit{
            background:#2563eb;
            color:white;
            border:none;
            padding:6px 12px;
            border-radius:6px;
            cursor:pointer;
        }

        .delete{
            background:#dc2626;
            color:white;
            border:none;
            padding:6px 12px;
            border-radius:6px;
            cursor:pointer;
        }

    </style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <div class="logo">
        <div class="logo-circle">N</div>
        Nyxora Technology
    </div>

    <div class="right-icons">
        <i class="fa-regular fa-envelope"></i>
        <i class="fa-regular fa-bell"></i>
        <i class="fa-solid fa-right-from-bracket"></i>
    </div>
</div>


<!-- SIDEBAR -->
<div class="sidebar">
    <ul class="menu">

        <li><a href="/dashboard.html"><i class="fa-solid fa-border-all"></i> Dashboard</a></li>
        <li><a href="/employees.html"><i class="fa-solid fa-users"></i> Employees</a></li>
        <li><a href="/attendance.html"><i class="fa-regular fa-calendar"></i> Attendance</a></li>
        <li><a href="/leaves.html"><i class="fa-regular fa-file-lines"></i> Leaves</a></li>
        <li><a href="/payroll.html"><i class="fa-solid fa-dollar-sign"></i> Payroll</a></li>
        <li><a href="/performance.html"><i class="fa-solid fa-chart-line"></i> Performance</a></li>
        <li><a class="active" href="/departments.html"><i class="fa-solid fa-building"></i> Departments</a></li>
        <li><a href="/reports.html"><i class="fa-solid fa-chart-bar"></i> Reports</a></li>

    </ul>
</div>


<div class="content">

<h2>Departments</h2>
<p>Manage company departments</p>

<!-- SEARCH -->
<div class="search-box">
<input id="search" type="text" placeholder="Search department">
<button onclick="searchDept()">Search</button>
</div>


<!-- ADD FORM -->
<div class="form-section">
<h3>Add Department</h3>

<div class="form-grid">
<input id="name" placeholder="Department Name">
<input id="manager" placeholder="Manager Name">
<input id="total" type="number" placeholder="Total Employees">
</div>

<button class="add-btn" onclick="save()">Save</button>
</div>



<!-- TABLE -->
<div class="form-section">
<h3>Department List</h3>

<table class="table">
<thead>
<tr>
<th>Name</th>
<th>Manager</th>
<th>Employees</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

</div>

</div>

<script>

const BASE = window.location.origin;
let editId=null;

window.onload=load;

function load(){
fetch(BASE+"/department/all")
.then(res=>res.json())
.then(data=>render(data));
}


/* SAVE / UPDATE */
function save(){

const data={
name:document.getElementById("name").value,
manager:document.getElementById("manager").value,
totalEmployees:Number(document.getElementById("total").value)
};

let url=BASE+"/department/add";
let method="POST";

if(editId){
url=BASE+"/department/update/"+editId;
method="PUT";
}

fetch(url,{
method:method,
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
})
.then(res=>res.text())
.then(msg=>{
alert(msg);
editId=null;
load();
});
}


/* DELETE */
function del(id){
fetch(BASE+"/department/delete/"+id,{method:"DELETE"})
.then(res=>res.text())
.then(msg=>{
alert(msg);
load();
});
}


/* EDIT */
function edit(id,name,manager,total){

document.getElementById("name").value=name;
document.getElementById("manager").value=manager;
document.getElementById("total").value=total;

editId=id;
}


/* SEARCH */
function searchDept(){

const name=document.getElementById("search").value;

if(!name){
alert("Enter department name");
return;
}

fetch(BASE+"/department/search/"+name)
.then(res=>res.json())
.then(data=>{

if(data.length===0){
alert("No department found");
return;
}

let msg="Department Results\n\n";

data.forEach(d=>{
msg+=
"Name: "+d.name+
"\nManager: "+d.manager+
"\nEmployees: "+d.totalEmployees+
"\n\n";
});

alert(msg);

});
}


/* TABLE */
function render(list){

let html="";

list.forEach(d=>{
html+=`
<tr>
<td>${d.name}</td>
<td>${d.manager}</td>
<td>${d.totalEmployees}</td>
<td>
<button onclick="edit(${d.id},'${d.name}','${d.manager}',${d.totalEmployees})">Edit</button>
<button onclick="del(${d.id})">Delete</button>
</td>
</tr>
`;
});

document.getElementById("tbody").innerHTML=html;
}

</script>



</body>
</html>
