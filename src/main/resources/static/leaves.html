<!DOCTYPE html>
<html>
<head>
    <title>Leaves</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>

        /* RESET */
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family:"Segoe UI",sans-serif;
        }

        /* HEADER FIXED */
        .header{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:60px;
            background:#e9e9ea;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:0 25px;
            z-index:1000;
        }

        .logo{
            display:flex;
            align-items:center;
            gap:12px;
            font-weight:600;
            font-size:22px;
            color:#1c2556;
        }

        .logo-circle{
            width:40px;
            height:40px;
            border:3px solid #1fa3a3;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            color:#1fa3a3;
            font-weight:bold;
        }

        .right-icons{
            display:flex;
            gap:22px;
            font-size:18px;
            color:#444;
        }


        /* SIDEBAR FIXED */
        .sidebar{
            position:fixed;
            top:60px;
            left:0;
            width:260px;
            height:calc(100vh - 60px);
            background:linear-gradient(#0b1437,#081028);
            padding:20px 15px;
            overflow-y:auto;
        }

        .menu{
            list-style:none;
        }

        .menu a{
            display:flex;
            align-items:center;
            gap:15px;
            padding:14px 18px;
            color:#cfd6ff;
            font-size:18px;
            text-decoration:none;
            border-radius:12px;
        }

        .menu a:hover{
            background:#111c44;
        }

        .menu a.active{
            background:linear-gradient(90deg,#5a4bff,#6f63ff);
            color:white;
        }


        /* CONTENT SCROLL */
        .content{
            margin-left:260px;
            margin-top:60px;
            height:calc(100vh - 60px);
            overflow-y:auto;
            padding:30px;
            background:#f5f7fb;
        }


        /* SEARCH */
        .search-box{
            margin:20px 0;
            display:flex;
            gap:10px;
        }

        .search-box input{
            flex:1;
            padding:12px;
            border-radius:8px;
            border:1px solid #ccc;
        }

        .search-box button{
            padding:12px 20px;
            border:none;
            background:#4f46e5;
            color:white;
            border-radius:8px;
            cursor:pointer;
        }


        /* FORM SECTION */
        .form-section{
            background:white;
            padding:25px;
            border-radius:14px;
            margin-top:25px;
            box-shadow:0 4px 12px rgba(0,0,0,0.08);
        }

        .form-section h3{
            margin-bottom:18px;
        }

        .form-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
            gap:18px;
        }

        .form-grid input,
        .form-grid select{
            padding:12px;
            border-radius:8px;
            border:1px solid #ccc;
        }


        /* BUTTON */
        .add-btn{
            margin-top:20px;
            padding:12px 25px;
            background:#059669;
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
        }

        .approve{
            background:#16a34a;
            color:white;
            border:none;
            padding:6px 12px;
            border-radius:6px;
        }

        .reject{
            background:#dc2626;
            color:white;
            border:none;
            padding:6px 12px;
            border-radius:6px;
        }


        /* TABLE */
        .table{
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
        }

        .table th{
            background:#eef2ff;
            padding:12px;
            text-align:left;
        }

        .table td{
            padding:12px;
            border-bottom:1px solid #eee;
        }

        .approved{color:green;font-weight:600;}
        .rejected{color:red;font-weight:600;}

    </style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <div class="logo">
        <div class="logo-circle">N</div>
        Nyxora Technology
    </div>

    <div class="right-icons">
        <i class="fa-regular fa-envelope"></i>
        <i class="fa-regular fa-bell"></i>
        <i class="fa-solid fa-right-from-bracket"></i>
    </div>
</div>


<!-- SIDEBAR -->
<div class="sidebar">
    <ul class="menu">

        <li><a href="/dashboard.html"><i class="fa-solid fa-border-all"></i> Dashboard</a></li>
        <li><a href="/employees.html"><i class="fa-solid fa-users"></i> Employees</a></li>
        <li><a href="/attendance.html"><i class="fa-regular fa-calendar"></i> Attendance</a></li>
        <li><a class="active" href="/leaves.html"><i class="fa-regular fa-file-lines"></i> Leaves</a></li>
        <li><a href="/payroll.html"><i class="fa-solid fa-dollar-sign"></i> Payroll</a></li>
        <li><a href="/performance.html"><i class="fa-solid fa-chart-line"></i> Performance</a></li>
        <li><a href="/departments.html"><i class="fa-solid fa-building"></i> Departments</a></li>
        <li><a href="/reports.html"><i class="fa-solid fa-chart-bar"></i> Reports</a></li>

    </ul>
</div>


<!-- CONTENT -->
<div class="content">

<h2>Leave Management</h2>
<p>Manage employee leave requests</p>


<!-- SEARCH -->
<div class="search-box">
<input id="searchId" type="number" placeholder="Search employee ID">
<button onclick="searchLeave()">Search</button>
</div>


<!-- APPLY -->
<div class="form-section">
<h3>Apply Leave</h3>

<div class="form-grid">
<input id="empId" type="number" placeholder="Employee ID">
<input id="empName" type="text" placeholder="Employee Name">

<select id="type">
<option value="">Leave Type</option>
<option>Sick Leave</option>
<option>Casual Leave</option>
<option>Paid Leave</option>
<option>Unpaid Leave</option>
</select>

<input id="from" type="date">
<input id="to" type="date">

<input id="reason" type="text" placeholder="Reason">
</div>

<button class="add-btn" onclick="applyLeave()">Submit Request</button>
</div>



<!-- TABLE -->
<div class="form-section">
<h3>Leave Records</h3>

<table class="table">
<thead>
<tr>
<th>EmpID</th>
<th>Name</th>
<th>Type</th>
<th>From</th>
<th>To</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

</table>
</div>

</div>

<script>

const BASE = window.location.origin;


/* LOAD ALL */
window.onload=loadLeaves;

function loadLeaves(){
fetch(BASE+"/leave/all")
.then(res=>res.json())
.then(data=>render(data));
}


/* APPLY */
function applyLeave(){

const data={
employeeId:Number(document.getElementById("empId").value),
name:document.getElementById("empName").value,
type:document.getElementById("type").value,
fromDate:document.getElementById("from").value,
toDate:document.getElementById("to").value,
reason:document.getElementById("reason").value
};

fetch(BASE+"/leave/apply",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
})
.then(res=>res.text())
.then(msg=>{
alert(msg);
loadLeaves();
});
}


/* SEARCH */
function searchLeave(){

const id=document.getElementById("searchId").value.trim();

if(id===""){
alert("Enter ID");
return;
}

fetch("http://localhost:8080/leave/search/"+id)
.then(res=>{
if(!res.ok) throw new Error("Server error");
return res.json();
})
.then(data=>{

if(data.length===0){
alert("No record found");
return;
}

let msg="Leave Records\n\n";

data.forEach(l=>{
msg +=
"ID: "+l.employeeId+
"\nName: "+l.name+
"\nType: "+l.type+
"\nFrom: "+l.fromDate+
"\nTo: "+l.toDate+
"\nStatus: "+l.status+
"\nReason: "+l.reason+
"\n\n";
});

alert(msg);

render(data);

})
.catch(err=>alert("Error: "+err.message));

}



/* APPROVE */
function approve(id){
fetch(BASE+"/leave/approve/"+id,{method:"PUT"})
.then(res=>res.text())
.then(msg=>{
alert(msg);
loadLeaves();
});
}


/* REJECT */
function reject(id){
fetch(BASE+"/leave/reject/"+id,{method:"PUT"})
.then(res=>res.text())
.then(msg=>{
alert(msg);
loadLeaves();
});
}


/* TABLE RENDER */
function render(list){

let html="";

list.forEach(l=>{

html+=`
<tr>
<td>${l.employeeId}</td>
<td>${l.name}</td>
<td>${l.type}</td>
<td>${l.fromDate}</td>
<td>${l.toDate}</td>
<td>${l.status}</td>
<td>
<button onclick="approve(${l.id})">Approve</button>
<button onclick="reject(${l.id})">Reject</button>
</td>
</tr>
`;

});

document.getElementById("tbody").innerHTML=html;

}

</script>



</body>
</html>
